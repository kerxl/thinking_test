# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö - SQL —Å–∫—Ä–∏–ø—Ç—ã

–≠—Ç–æ—Ç –∫–∞—Ç–∞–ª–æ–≥ —Å–æ–¥–µ—Ä–∂–∏—Ç SQL —Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö PostgreSQL –ø—Ä–æ–µ–∫—Ç–∞.

## üìÅ –û–ø–∏—Å–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤

### –û—Å–Ω–æ–≤–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã

- **`create_database.sql`** - –°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- **`create_tables.sql`** - –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü –∏ –∏–Ω–¥–µ–∫—Å–æ–≤
- **`clean_database.sql`** - –û—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö (–Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤)
- **`drop_database.sql`** - –ü–æ–ª–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã

- **`sample_data.sql`** - –í—Å—Ç–∞–≤–∫–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- **`queries.sql`** - –ü–æ–ª–µ–∑–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –¥–∞–Ω–Ω—ã—Ö

## üöÄ –ü–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

### –ü–µ—Ä–≤–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞

1. **–°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö** (–æ—Ç –∏–º–µ–Ω–∏ —Å—É–ø–µ—Ä–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è postgres):
```bash
sudo -u postgres psql -f database/create_database.sql
```

2. **–°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü**:
```bash
psql -U postgres -d mind_style -f database/create_tables.sql
```

3. **[–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ] –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö**:
```bash
psql -U postgres -d mind_style -f database/sample_data.sql
```


–¢–∞–∫–∂–µ –æ–±–Ω–æ–≤–∏—Ç–µ —Ñ–∞–π–ª `.env`:
```env
DATABASE_URL=postgresql+asyncpg://postgres:postgres@localhost/mind_style
```

## üßπ –û—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö

### –í–∞—Ä–∏–∞–Ω—Ç 1: –û—á–∏—Å—Ç–∫–∞ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö
```bash
psql -U postgres -d mind_style -f database/clean_database.sql
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –í—ã–±–æ—Ä–æ—á–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞
–û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª `clean_database.sql` –∏ —Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ –Ω—É–∂–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏ –¥–ª—è:
- –£–¥–∞–ª–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤
- –£–¥–∞–ª–µ–Ω–∏—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –£–¥–∞–ª–µ–Ω–∏—è —Å—Ç–∞—Ä—ã—Ö –∑–∞–ø–∏—Å–µ–π

### –í–∞—Ä–∏–∞–Ω—Ç 3: –ü–æ–ª–Ω–æ–µ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏–µ
```bash
# –£–¥–∞–ª–µ–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
sudo -u postgres psql -f database/drop_database.sql

# –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–Ω–æ–≤–æ
sudo -u postgres psql -f database/create_database.sql
psql -U postgres -d mind_style -f database/create_tables.sql
```

## üìä –ê–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö

–í—ã–ø–æ–ª–Ω–∏—Ç–µ –≥–æ—Ç–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞:
```bash
psql -U postgres -d mind_style -f database/queries.sql
```

–ò–ª–∏ –ø–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ –±–∞–∑–µ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ:
```bash
psql -U postgres -d mind_style
```

### –ü–æ–ª–µ–∑–Ω—ã–µ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:

```sql
-- –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
SELECT COUNT(*) as total, COUNT(*) FILTER (WHERE test_completed = TRUE) as completed FROM users;

-- –ü–æ—Å–ª–µ–¥–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
SELECT user_id, username, created_at FROM users ORDER BY created_at DESC LIMIT 5;

-- –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Ç–µ–º–ø–µ—Ä–∞–º–µ–Ω—Ç–∞–º
SELECT temperament, COUNT(*) FROM users WHERE temperament IS NOT NULL GROUP BY temperament;
```

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:
1. **–°–º–µ–Ω–∏—Ç–µ –ø–∞—Ä–æ–ª—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é** –≤ `create_database.sql`
2. **–û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è** –≤ `pg_hba.conf` –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
3. **–†–µ–≥—É–ª—è—Ä–Ω–æ –¥–µ–ª–∞–π—Ç–µ –±—ç–∫–∞–ø—ã**:
```bash
pg_dump -U postgres mind_style > backup_$(date +%Y%m%d_%H%M%S).sql
```

4. **–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ –±—ç–∫–∞–ø–∞**:
```bash
psql -U postgres -d mind_style < backup_file.sql
```

## üêõ –û—Ç–ª–∞–¥–∫–∞

### –ü—Ä–æ–±–ª–µ–º—ã —Å –ø—Ä–∞–≤–∞–º–∏ –¥–æ—Å—Ç—É–ø–∞:
```sql
-- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
SELECT current_user, current_database();

-- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –Ω–∞ —Ç–∞–±–ª–∏—Ü—ã
SELECT grantee, table_name, privilege_type 
FROM information_schema.role_table_grants 
WHERE table_name = 'users';
```

### –ü—Ä–æ–±–ª–µ–º—ã —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º:
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ PostgreSQL
sudo systemctl status postgresql

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä—Ç–æ–≤
sudo netstat -tlnp | grep 5432

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ PostgreSQL
sudo tail -f /var/log/postgresql/postgresql-*-main.log
```

## üéØ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü—ã users

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| `id` | SERIAL PRIMARY KEY | –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π ID |
| `user_id` | BIGINT UNIQUE | ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ Telegram |
| `username` | VARCHAR(255) | @username –≤ Telegram |
| `first_name` | VARCHAR(255) | –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| `last_name` | VARCHAR(255) | –§–∞–º–∏–ª–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| `age` | INTEGER | –í–æ–∑—Ä–∞—Å—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| `test_start` | TIMESTAMP | –í—Ä–µ–º—è –Ω–∞—á–∞–ª–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è |
| `test_end` | TIMESTAMP | –í—Ä–µ–º—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è |
| `answers_json` | JSONB | –í—Å–µ –æ—Ç–≤–µ—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| `inq_scores_json` | JSONB | –†–µ–∑—É–ª—å—Ç–∞—Ç—ã INQ —Ç–µ—Å—Ç–∞ |
| `epi_scores_json` | JSONB | –†–µ–∑—É–ª—å—Ç–∞—Ç—ã EPI —Ç–µ—Å—Ç–∞ |
| `priorities_json` | JSONB | –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∞ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤ |
| `temperament` | VARCHAR(50) | –û–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–π —Ç–µ–º–ø–µ—Ä–∞–º–µ–Ω—Ç |
| `current_task_type` | INTEGER | –¢–µ–∫—É—â–∏–π —Ç–∏–ø —Ç–µ—Å—Ç–∞ (1-3) |
| `current_question` | INTEGER | –ù–æ–º–µ—Ä —Ç–µ–∫—É—â–µ–≥–æ –≤–æ–ø—Ä–æ—Å–∞ |
| `current_step` | INTEGER | –¢–µ–∫—É—â–∏–π —à–∞–≥ –≤ –≤–æ–ø—Ä–æ—Å–µ |
| `test_completed` | BOOLEAN | –§–ª–∞–≥ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤ |
| `created_at` | TIMESTAMP | –í—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–ø–∏—Å–∏ |
| `updated_at` | TIMESTAMP | –í—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è |